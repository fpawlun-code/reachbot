<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szczecin Business Scraper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .main-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .industry-btn { background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 12px 20px; margin: 5px; cursor: pointer; transition: all 0.2s; display: inline-block; text-decoration: none; color: #333; }
        .industry-btn:hover { background: #667eea; color: white; border-color: #667eea; transform: scale(1.05); }
        .business-card { border-left: 4px solid #667eea; transition: transform 0.2s; }
        .business-card:hover { transform: translateX(5px); }
        .bookmarklet-btn { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; padding: 15px 30px; font-size: 1.1rem; cursor: move; }
        .step-number { width: 40px; height: 40px; background: #667eea; color: white; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .code-box { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.9rem; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="text-center text-white mb-4">
                    <h1 class="display-4 fw-bold"><i class="bi bi-search"></i> Szczecin Business Scraper</h1>
                    <p class="lead">Znajd藕 firmy w Szczecinie przez Google - bez blokad!</p>
                </div>

                <div class="main-card p-4 p-md-5">
                    <!-- Step 1: Instructions -->
                    <div class="mb-5">
                        <h4><span class="step-number">1</span> Przecignij bookmarklet na pasek zakadek</h4>
                        <p class="text-muted ms-5">Przecignij poni偶szy przycisk na pasek zakadek przegldarki:</p>
                        <div class="text-center my-4">
                            <a class="btn btn-lg bookmarklet-btn text-white" href="javascript:(function(){const results=[];const seen=new Set();function add(name,url,snippet){if(!name||!url||seen.has(url))return;seen.add(url);results.push({name:name.trim(),url,snippet:snippet||''});}document.querySelectorAll('div.g').forEach(r=>{const link=r.querySelector('a');const title=r.querySelector('h3');if(link&&title)add(title.innerText,link.href,r.querySelector('.VwiC3b')?.innerText);});document.querySelectorAll('[data-cid]').forEach(r=>{const name=r.querySelector('.OSrXXb')?.innerText||r.querySelector('.qBF1Pd')?.innerText;const link=r.querySelector('a[href*=\x22/maps/\x22]')||r.querySelector('a');if(name&&link)add(name,link.href,'Google Maps');});document.querySelectorAll('.VkpGBb').forEach(r=>{const name=r.querySelector('.OSrXXb')?.innerText||r.querySelector('span')?.innerText;const link=r.querySelector('a');if(name&&link)add(name,link.href,'Places');});document.querySelectorAll('a[data-ved]').forEach(a=>{const h3=a.querySelector('h3');if(h3&&a.href&&!a.href.includes('google.com'))add(h3.innerText,a.href,'');});if(results.length===0){alert('Nie znaleziono wynik贸w (0). Przewi stron w d贸 i spr贸buj ponownie.');return;}const data=encodeURIComponent(JSON.stringify(results.slice(0,25)));window.open('https://reachbot-delta.vercel.app/?data='+data,'_blank');})();">
                                 Zbierz z Google
                            </a>
                        </div>
                        <p class="text-muted small text-center"><i class="bi bi-info-circle"></i> Jeli nie widzisz paska zakadek: Ctrl+Shift+B (Chrome/Edge) lub Ctrl+B (Firefox)</p>
                    </div>

                    <!-- Step 2: Search Links -->
                    <div class="mb-5">
                        <h4><span class="step-number">2</span> Kliknij bran偶 aby otworzy Google</h4>
                        <p class="text-muted ms-5">Otw贸rz wyszukiwanie Google dla wybranej bran偶y:</p>
                        <div class="text-center my-4" id="searchLinks">
                            <a class="industry-btn" href="https://www.google.pl/search?q=restauracje+szczecin&num=20" target="_blank"><i class="bi bi-shop"></i> Restauracje</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=kawiarnie+szczecin&num=20" target="_blank"><i class="bi bi-cup-hot"></i> Kawiarnie</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=fryzjer+szczecin&num=20" target="_blank"><i class="bi bi-scissors"></i> Fryzjerzy</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=dentysta+szczecin&num=20" target="_blank"><i class="bi bi-emoji-smile"></i> Dentyci</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=mechanik+samochodowy+szczecin&num=20" target="_blank"><i class="bi bi-car-front"></i> Mechanicy</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=piekarnia+szczecin&num=20" target="_blank"><i class="bi bi-basket"></i> Piekarnie</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=kwiaciarnia+szczecin&num=20" target="_blank"><i class="bi bi-flower1"></i> Kwiaciarnie</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=prawnik+adwokat+szczecin&num=20" target="_blank"><i class="bi bi-briefcase"></i> Prawnicy</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=hotel+szczecin&num=20" target="_blank"><i class="bi bi-building"></i> Hotele</a>
                            <a class="industry-btn" href="https://www.google.pl/search?q=siownia+fitness+szczecin&num=20" target="_blank"><i class="bi bi-heart-pulse"></i> Siownie</a>
                        </div>
                    </div>

                    <!-- Step 3: Use Bookmarklet -->
                    <div class="mb-5">
                        <h4><span class="step-number">3</span> Na stronie Google kliknij bookmarklet</h4>
                        <p class="text-muted ms-5">Po otwarciu wynik贸w Google, kliknij " Zbierz z Google" na pasku zakadek. Wyniki pojawi si poni偶ej.</p>
                    </div>

                    <!-- Results Section -->
                    <div id="results" style="display:none">
                        <hr class="my-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4><i class="bi bi-check-circle text-success"></i> Zebrane wyniki</h4>
                            <button class="btn btn-outline-danger btn-sm" onclick="clearResults()"><i class="bi bi-trash"></i> Wyczy</button>
                        </div>

                        <div class="alert alert-success">
                            Zebrano <strong id="resultCount">0</strong> firm z Google!
                        </div>

                        <div id="businessList"></div>

                        <div class="text-center mt-4">
                            <button class="btn btn-success btn-lg me-2" onclick="downloadCSV()">
                                <i class="bi bi-download"></i> Pobierz CSV
                            </button>
                            <button class="btn btn-primary btn-lg" onclick="copyToClipboard()">
                                <i class="bi bi-clipboard"></i> Kopiuj
                            </button>
                        </div>
                    </div>

                    <!-- Custom Search -->
                    <div class="mt-5 pt-4 border-top">
                        <h5><i class="bi bi-search"></i> Wasne wyszukiwanie</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" id="customQuery" placeholder="np. salon kosmetyczny szczecin">
                            <button class="btn btn-primary" onclick="customSearch()">Szukaj w Google</button>
                        </div>
                    </div>
                </div>

                <div class="text-center text-white mt-4">
                    <p class="small">Dane zbierane s w Twojej przegldarce - bez blokad!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allResults = [];

        // Check for data in URL on page load
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');

            if (data) {
                try {
                    const newResults = JSON.parse(decodeURIComponent(data));
                    if (Array.isArray(newResults) && newResults.length > 0) {
                        // Add to existing results (avoid duplicates)
                        const existingUrls = new Set(allResults.map(r => r.url));
                        newResults.forEach(r => {
                            if (!existingUrls.has(r.url)) {
                                allResults.push(r);
                                existingUrls.add(r.url);
                            }
                        });
                        showResults();
                        // Clean URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                } catch (e) {
                    console.error('Error parsing data:', e);
                }
            }

            // Load from localStorage
            const saved = localStorage.getItem('szczecin_results');
            if (saved) {
                try {
                    allResults = JSON.parse(saved);
                    if (allResults.length > 0) {
                        showResults();
                    }
                } catch (e) {}
            }
        });

        function showResults() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('resultCount').textContent = allResults.length;

            const list = document.getElementById('businessList');
            list.innerHTML = allResults.map((b, i) => `
                <div class="card business-card mb-3">
                    <div class="card-body">
                        <h5>${b.name}</h5>
                        <div class="small text-muted">
                            <a href="${b.url}" target="_blank" class="text-primary">
                                <i class="bi bi-link-45deg"></i> ${b.url.substring(0, 60)}...
                            </a>
                        </div>
                        ${b.snippet ? `<p class="small mt-2 mb-0 text-muted">${b.snippet.substring(0, 150)}...</p>` : ''}
                    </div>
                </div>
            `).join('');

            // Save to localStorage
            localStorage.setItem('szczecin_results', JSON.stringify(allResults));
        }

        function clearResults() {
            if (confirm('Czy na pewno chcesz wyczyci wszystkie wyniki?')) {
                allResults = [];
                localStorage.removeItem('szczecin_results');
                document.getElementById('results').style.display = 'none';
            }
        }

        function downloadCSV() {
            let csv = 'Nazwa;URL;Opis\n';
            allResults.forEach(b => {
                const name = b.name.replace(/"/g, '""');
                const url = b.url;
                const snippet = (b.snippet || '').replace(/"/g, '""').replace(/\n/g, ' ');
                csv += `"${name}";"${url}";"${snippet}"\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'firmy_szczecin_google.csv';
            a.click();
        }

        function copyToClipboard() {
            const text = allResults.map(b => `${b.name}\n${b.url}`).join('\n\n');
            navigator.clipboard.writeText(text).then(() => {
                alert('Skopiowano do schowka!');
            });
        }

        function customSearch() {
            const query = document.getElementById('customQuery').value.trim();
            if (query) {
                window.open(`https://www.google.pl/search?q=${encodeURIComponent(query)}&num=20`, '_blank');
            }
        }
    </script>
</body>
</html>
